<%- include("sidebar") %>

<div class="tela-quiz">
    <!-- Imagem FUNDO -->
    <div id="background-container" class="bg-metro"></div>

    <!-- Texto SOBREPOSIÇÃO -->
    <div id="text-container" class="p-3 absolute-bottom">
        <p class="text-center">O texto das perguntas deve ser inserido aqui!</p>
    </div>

        
    <!-- Resultado -->
    <div id="result-container" class="d-none">
        <div class="t-quiz h1">RESULTADO</div>
        <div class="my-3">
            <img id="img-res" width=30% alt="imagem do sabonete" src=""/>
            <div id="txt-res" class="h2 mt-4"></div>
        </div>
        <div class="p-3">
            <button id="restart-btn" type="button" class="btn btn-light btn-lg">RECOMEÇAR</button>
            <a id="btn-loja" class="btn btn-success btn-lg" href="">VER NA LOJA</a>
        </div>
    </div>

    <!-- Erro -->
    <div id="error-container" class="text-center d-none">
        <div class="t-quiz h1">OPS...</div>
        <div>
            <img width=25% alt="nome sabonete" src="https://weakwifisolutions.com/wp-content/uploads/2019/08/error-red-cross-1.png?ezimgfmt=rs:372x372/rscb2/ng:webp/ngcb2"/>
            <div class="h2">Desculpa, o seu resultado não foi encontrado. Por favor, tente novamente.</div>
        </div>
    </div>

</div>

<!-- Questões APARIÇÃO -->
<div id="question-container" class="bg-dark bottom-nav">
    <div id="answer-buttons" class="d-flex justify-content-around flex-wrap">
        <button class="btn btn-secondary align-self-center">Resposta 1</button>
        <button class="btn btn-secondary align-self-center">Resposta 2</button>
        <button class="btn btn-secondary align-self-center">Resposta 3</button>
        <button class="btn btn-secondary align-self-center">Resposta 4</button>
    </div>
</div>

<script type="text/javascript" src="/js/intro.js"></script>
<script type="text/javascript" src="/js/dia1.js"></script>
<script type="text/javascript" src="/js/dia2.js"></script>
<script type="text/javascript" src="/js/dia3.js"></script>
<script type="text/javascript" src="/js/dia4.js"></script>


<script type="text/javascript">
    let _diaAtual = [];
    const containerText = $("#text-container")
    const containerBtn = $("#answer-buttons")
    const containerBg = $("#background-container")
    var _nomeJogador = "";
    var _pontuacao = 0;
    var _hotdog, _local, _preco, _promocao;

    $(function() {
        comecarJogo();
    })

    /* startButton.addEventListener('click', comecarJogo)
    nextButton.addEventListener('click', () => {
        /* escolherResposta();
        currentQuestionIndex++
        proximaPergunta()
    })
    finalizeButton.addEventListener('click', () => {
        escolherResposta();
        currentQuestionIndex++
        mostrarResultado() (?)
        questionContainerElement.classList.add('fade-out')
        setTimeout(telaLista, 1500)
    }) */

    function comecarJogo() {
        mudarDia(_intro);
    }

    function proximoTexto() {
        try {
            // remove o elemento do array e joga no container
            containerText.html(_diaAtual.shift())

            if(_diaAtual[0].trim().startsWith("codigo")) { // o próximo texto é um código
                let codigo = _diaAtual.shift().replace("codigo", "").trim()
                console.log(codigo)
                let funcao = new Function(codigo)
                return (funcao())
            }
        } catch(e) {
            console.log(`Oops, ocorreu um erro: ${e}`)
        }
    }

    containerText.click(() => proximoTexto())

    function montarInput(variavel) {
        limparBotoes()
        containerText.off("click")
        let input = document.createElement("input")
        input.id = "inputName"
        input.type = "text"
        input.classList.add("form-control")
        input.classList.add("input-sm")
        input.addEventListener("keyup", event => {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                event.preventDefault();
                sendBtn.click();
            }
        })
        
        let sendBtn = document.createElement("button")
        sendBtn.classList.add("btn")
        sendBtn.classList.add("btn-secondary")
        sendBtn.innerHTML = "<i class='fas fa-paper-plane'></i>"
        sendBtn.addEventListener("click", event => {
            if(input.value != "") { // Só envia inputs preenchidos
                eval(variavel + " = " + "'" + input.value + "'")
                closeQuestions()
                containerText.append(`<span class="player d-block">&gt "${input.value}"</span>`)
                containerText.on("click", () => {proximoTexto()})
            }
        })

        containerBtn.append(input)
        containerBtn.append(sendBtn)
        openQuestions()
    }

    function montarEscolhas(contexto) {
        limparBotoes()
        containerText.off("click") // Congela o container com o texto atual
        // Criar os botões
        contexto.html.forEach((info, i) => {
            let btn = document.createElement("button")
                btn.type = "button"
                btn.innerText = info.titulo
                btn.classList.add(`btn`)
                btn.classList.add(`btn-${info.cor}`)
            
            // Ao ser clicado
            btn.addEventListener("click", event => {
                containerText.append(`<span class="player d-block">&gt "${info.frase}"</span>`)
                // Salvar em variável
                eval(`${contexto.variavel} = {texto: '${info.titulo}', valor: '${info.valor}'}`)
                // Somar na pontuação global
                if(info.pontos) {
                    _pontuacao += parseInt( info.pontos[eval(contexto.varPontos).valor] )
                }

                if(contexto.errada == i + 1) {
                    mudarArray(contexto.alternativo)
                } else {
                    mudarArray(contexto.padrao)
                }
                closeQuestions()
                containerText.on("click", () => {proximoTexto()}) // Voltar o clique na caixa de texto
            })
            containerBtn.append(btn)
        })
        openQuestions()

    }

    function limparBotoes() {
        containerBtn.html("")
    }

    function mudarBg(novoBg) {
        if(!novoBg.startsWith("bg-")) { // Se não vier como classe css
            novoBg = novoBg.toLowerCase().replace(/^/, "bg-")
        }
        // assíncrono
        $.when(containerBg.fadeOut(800))
            .then(function() {
                containerBg.removeClass()
                containerBg.addClass(novoBg)
            }, () => {})
            .then(function() {containerBg.fadeIn(800)}, () => {})
    }

    function clicouBotao() {
        
    }
    
    function escolherResposta() {

    }

    function mostrarResultado(produto) {
        
    }

    function mudarDia(novoDia) {
        _diaAtual = novoDia.map((x) => x);
        proximoTexto();
    }

    function mudarArray(novaTrilha) {
        _diaAtual = novaTrilha.map((x) => x);
    }

    
</script>