<%- include("sidebar") %>

<div class="tela-quiz">
    <!-- Imagem FUNDO -->
    <div id="background-container" class="bg-metro">
        <button type="button" class="btn btn-outline-primary" onclick="openQuestions()">Abrir</button>
        <button type="button" class="btn btn-outline-secondary" onclick="closeQuestions()">Fechar</button>
    </div>

    <!-- Texto SOBREPOSIÇÃO -->
    <div id="text-container" class="p-3 absolute-bottom">
        <p class="text-center">O texto das perguntas deve ser inserido aqui!</p>
    </div>

        
    <!-- Resultado -->
    <div id="result-container" class="d-none">
        <div class="t-quiz h1">RESULTADO</div>
        <div class="my-3">
            <img id="img-res" width=30% alt="imagem do sabonete" src=""/>
            <div id="txt-res" class="h2 mt-4"></div>
        </div>
        <div class="p-3">
            <button id="restart-btn" type="button" class="btn btn-light btn-lg">RECOMEÇAR</button>
            <a id="btn-loja" class="btn btn-success btn-lg" href="">VER NA LOJA</a>
        </div>
    </div>

    <!-- Erro -->
    <div id="error-container" class="text-center d-none">
        <div class="t-quiz h1">OPS...</div>
        <div>
            <img width=25% alt="nome sabonete" src="https://weakwifisolutions.com/wp-content/uploads/2019/08/error-red-cross-1.png?ezimgfmt=rs:372x372/rscb2/ng:webp/ngcb2"/>
            <div class="h2">Desculpa, o seu resultado não foi encontrado. Por favor, tente novamente.</div>
        </div>
    </div>

</div>

<!-- Questões APARIÇÃO -->
<div id="question-container" class="bg-dark bottom-nav">
    <div id="answer-buttons" class="d-flex justify-content-around flex-wrap">
        <button class="btn btn-secondary align-self-center">Resposta 1</button>
        <button class="btn btn-secondary align-self-center">Resposta 2</button>
        <button class="btn btn-secondary align-self-center">Resposta 3</button>
        <button class="btn btn-secondary align-self-center">Resposta 4</button>
    </div>
</div>

<script type="text/javascript" src="/js/intro.js"></script>
<script type="text/javascript" src="/js/dia1.js"></script>
<script type="text/javascript" src="/js/dia2.js"></script>

<script type="text/javascript">
    let _diaAtual = [];
    const containerText = $("#text-container")
    const containerBtn = $("#answer-buttons")

    $(function() {
        comecarJogo();
    })

    /* startButton.addEventListener('click', comecarJogo)
    nextButton.addEventListener('click', () => {
        /* escolherResposta();
        currentQuestionIndex++
        proximaPergunta()
    })
    finalizeButton.addEventListener('click', () => {
        escolherResposta();
        currentQuestionIndex++
        mostrarResultado() (?)
        questionContainerElement.classList.add('fade-out')
        setTimeout(telaLista, 1500)
    }) */

    function comecarJogo() {
        mudarDia(_dia1);
    }

    function proximoTexto() {
        try{
            if(_diaAtual[0].startsWith("codigo")) { // tornar o código funcional
                let codigo = _diaAtual.shift().replace("codigo", "").trim()
                let funcao = new Function(codigo)
                return (funcao())
            
            } else { // faz parte da história
                // remove o elemento do array e joga no container
                containerText.html(_diaAtual.shift())
            }
        } catch(e) {
            console.log(`Oops, ocorreu um erro: ${e}`)
        }
    }

    containerText.click(() => proximoTexto())

    function montarEscolhas(contexto) {
        limparBotoes()
        // Criar os botões
        contexto.html.forEach((info, i) => {
            let btn = document.createElement("button")
                btn.type = "button"
                btn.innerText = info.titulo
                btn.classList.add(`btn`)
                btn.classList.add(`btn-${info.cor}`)
            
            btn.addEventListener("click", event => {
                containerText.append(`<span class="player d-block">&gt "${info.frase}"</span>`)
                // TODO: atribuir valor à variável global

                if(contexto.errada == i + 1) {
                    mudarArray(contexto.alternativo)
                } else {
                    mudarArray(contexto.padrao)
                }
                closeQuestions()
            })
            containerBtn.append(btn)
        })
        openQuestions()

    }

    function limparBotoes() {
        containerBtn.html("")
    }

    function clicouBotao() {
        
    }
    
    function escolherResposta() {

    }

    function mostrarResultado(produto) {
        
    }

    function mudarDia(novoDia) {
        _diaAtual = novoDia.map((x) => x);
        proximoTexto();
    }

    function mudarArray(novaTrilha) {
        console.log(novaTrilha)
        _diaAtual = novaTrilha.map((x) => x);
    }

    
</script>